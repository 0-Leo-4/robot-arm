<!DOCTYPE html>
<html>
<head>
    <title>Pico Editor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #editor { 
            height: 70vh;
            width: 100%;
            border: 1px solid #666;
        }
        .dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container-fluid mt-3">
        <div class="row">
            <div class="col-md-3">
                <div class="d-flex gap-2 mb-3">
                    <button class="btn btn-sm btn-primary" onclick="loadFiles()">Refresh</button>
                    <button class="btn btn-sm btn-success" onclick="newFile()">New File</button>
                    <button class="btn btn-sm btn-danger" onclick="resetPico()">Reset Pico</button>
                </div>
                <div id="file-tree" class="list-group"></div>
            </div>
            
            <div class="col-md-9">
                <div class="mb-2">
                    <input type="text" id="filename" class="form-control dark-mode" placeholder="File name">
                </div>
                <div id="editor"></div>
                <div class="mt-2">
                    <button class="btn btn-primary" onclick="saveFile()">Save</button>
                    <button class="btn btn-danger" onclick="deleteFile()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script>
        let editor = ace.edit("editor")
        editor.setTheme("ace/theme/monokai")
        editor.session.setMode("ace/mode/python")
        let currentFile = null

        // Carica l'elenco dei file
        async function loadFiles() {
            const res = await fetch('/api/pico/files')
            const data = await res.json()
            
            const fileTree = document.getElementById('file-tree')
            fileTree.innerHTML = data.files.map(file => `
                <button class="list-group-item list-group-item-action dark-mode"
                        onclick="loadFile('${file}')">
                    ðŸ“„ ${file}
                </button>
            `).join('')
        }

        // Carica un file
        async function loadFile(filename) {
            currentFile = filename
            document.getElementById('filename').value = filename
            const res = await fetch(`/api/pico/file/${filename}`)
            const data = await res.json()
            editor.setValue(data.content || '')
        }

        // Salva il file
        async function saveFile() {
            const filename = document.getElementById('filename').value
            await fetch(`/api/pico/file/${filename}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({content: editor.getValue()})
            })
            loadFiles()
        }

        // Crea nuovo file
        function newFile() {
            currentFile = null
            document.getElementById('filename').value = ''
            editor.setValue('')
        }

        // Elimina file
        async function deleteFile() {
            if(currentFile && confirm(`Delete ${currentFile}?`)) {
                await fetch(`/api/pico/file/${currentFile}`, {method: 'DELETE'})
                loadFiles()
                newFile()
            }
        }

        // Resetta il Pico
        async function resetPico() {
            await fetch('/api/pico/reset', {method: 'POST'})
            setTimeout(loadFiles, 2000)  // Aspetta il reset
        }

        loadFiles() // Carica iniziale
    </script>
</body>
</html>